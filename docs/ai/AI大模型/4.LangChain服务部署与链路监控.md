**ç¤ºä¾‹ä»£ç **

[langchain-ops.ppt](https://www.yuque.com/attachments/yuque/0/2025/ppt/1387387/1745159935215-aebb9a71-4e7a-40f7-843a-f4e7a0bfdafc.ppt)

_<font style="color:#DF2A3F;">æ³¨ï¼šå°†pptåç¼€åæ”¹ä¸ºzipåè§£å‹</font>_

pythonç‰ˆæœ¬ï¼š3.12.4



**åˆ†äº«å†…å®¹**

1. LangServeæœåŠ¡éƒ¨ç½²
2. LangSmith Tracing(è·Ÿè¸ª)
3. Verbose(è¯¦ç»†æ—¥å¿—æ‰“å°)
4. Debug(è°ƒè¯•æ—¥å¿—æ‰“å°)



# LangServeæœåŠ¡éƒ¨ç½²
## <font style="color:rgb(28, 30, 33);">æ¦‚è¿°</font>
[<font style="color:rgb(28, 30, 33);">LangServe</font>](https://github.com/langchain-ai/langserve)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">ğŸ¦œ</font><font style="color:rgb(28, 30, 33);">ï¸</font><font style="color:rgb(28, 30, 33);">ğŸ“</font><font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å¸®åŠ©å¼€å‘è€…å°† </font>`<font style="color:rgb(28, 30, 33);">LangChain</font>`<font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">å¯è¿è¡Œå’Œé“¾</font>](https://python.langchain.com/docs/expression_language/)<font style="color:rgb(28, 30, 33);">éƒ¨ç½²ä¸º REST APIã€‚</font>

<font style="color:rgb(28, 30, 33);">è¯¥åº“é›†æˆäº†</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">FastAPI</font>](https://fastapi.tiangolo.com/)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å¹¶ä½¿ç”¨</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">pydantic</font>](https://docs.pydantic.dev/latest/)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">è¿›è¡Œæ•°æ®éªŒè¯ã€‚</font>

**<font style="color:rgb(28, 30, 33);">Pydantic</font>**<font style="color:rgb(28, 30, 33);"> æ˜¯ä¸€ä¸ªåœ¨ Pythonä¸­ç”¨äºæ•°æ®éªŒè¯å’Œè§£æçš„ç¬¬ä¸‰æ–¹åº“ï¼Œç°åœ¨æ˜¯Pythonä¸­ä½¿ç”¨å¹¿æ³›çš„æ•°æ®éªŒè¯åº“ã€‚</font>

+ <font style="color:rgb(28, 30, 33);">å®ƒåˆ©ç”¨å£°æ˜å¼çš„æ–¹å¼å®šä¹‰æ•°æ®æ¨¡å‹å’ŒPython ç±»å‹æç¤ºçš„å¼ºå¤§åŠŸèƒ½æ¥æ‰§è¡Œæ•°æ®éªŒè¯å’Œåºåˆ—åŒ–ï¼Œä½¿æ‚¨çš„ä»£ç æ›´å¯é ã€æ›´å¯è¯»ã€æ›´ç®€æ´ä¸”æ›´æ˜“äºè°ƒè¯•ã€‚ã€‚</font>
+ <font style="color:rgb(28, 30, 33);">å®ƒè¿˜å¯ä»¥ä»æ¨¡å‹ç”Ÿæˆ JSON æ¶æ„ï¼Œæä¾›äº†è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç­‰åŠŸèƒ½ï¼Œä»è€Œè½»æ¾ä¸å…¶ä»–å·¥å…·é›†æˆ</font>

<font style="color:rgb(28, 30, 33);">æ­¤å¤–ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¯ç”¨äºè°ƒç”¨éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„å¯è¿è¡Œå¯¹è±¡ã€‚JavaScript å®¢æˆ·ç«¯å¯åœ¨</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">LangChain.js</font>](https://js.langchain.com/docs/ecosystem/langserve)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">ä¸­æ‰¾åˆ°ã€‚</font>

## <font style="color:rgb(28, 30, 33);">ç‰¹æ€§</font>
+ <font style="color:rgb(28, 30, 33);">ä» LangChain å¯¹è±¡è‡ªåŠ¨æ¨æ–­è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼ï¼Œå¹¶åœ¨æ¯æ¬¡ API è°ƒç”¨ä¸­æ‰§è¡Œï¼Œæä¾›ä¸°å¯Œçš„é”™è¯¯ä¿¡æ¯</font>
+ <font style="color:rgb(28, 30, 33);">å¸¦æœ‰ JSONSchema å’Œ Swagger çš„ API æ–‡æ¡£é¡µé¢ï¼ˆæ’å…¥ç¤ºä¾‹é“¾æ¥ï¼‰</font>
+ <font style="color:rgb(28, 30, 33);">é«˜æ•ˆçš„</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">/invoke</font>`<font style="color:rgb(28, 30, 33);">ã€</font>`<font style="color:rgb(28, 30, 33);">/batch</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œ</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">/stream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">ç«¯ç‚¹ï¼Œæ”¯æŒå•ä¸ªæœåŠ¡å™¨ä¸Šçš„å¤šä¸ªå¹¶å‘è¯·æ±‚</font>
+ `<font style="color:rgb(28, 30, 33);">/stream_log</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">ç«¯ç‚¹ï¼Œç”¨äºæµå¼ä¼ è¾“é“¾/ä»£ç†çš„æ‰€æœ‰ï¼ˆæˆ–éƒ¨åˆ†ï¼‰ä¸­é—´æ­¥éª¤</font>
+ **<font style="color:rgb(28, 30, 33);">æ–°åŠŸèƒ½</font>**<font style="color:rgb(28, 30, 33);"> è‡ª 0.0.40 ç‰ˆæœ¬èµ·ï¼Œæ”¯æŒ </font>`<font style="color:rgb(28, 30, 33);">/stream_events</font>`<font style="color:rgb(28, 30, 33);">ï¼Œä½¿æµå¼ä¼ è¾“æ›´åŠ ç®€ä¾¿ï¼Œæ— éœ€è§£æ </font>`<font style="color:rgb(28, 30, 33);">/stream_log</font>`<font style="color:rgb(28, 30, 33);"> çš„è¾“å‡ºã€‚</font>
+ <font style="color:rgb(28, 30, 33);">ä½¿ç”¨ç»è¿‡ä¸¥æ ¼æµ‹è¯•çš„å¼€æº Python åº“æ„å»ºï¼Œå¦‚ FastAPIã€Pydanticã€uvloop å’Œ asyncioã€‚</font>
+ <font style="color:rgb(28, 30, 33);">ä½¿ç”¨å®¢æˆ·ç«¯ SDK è°ƒç”¨ LangServe æœåŠ¡å™¨ï¼Œå°±åƒæœ¬åœ°è¿è¡Œå¯è¿è¡Œå¯¹è±¡ä¸€æ ·ï¼ˆæˆ–ç›´æ¥è°ƒç”¨ HTTP APIï¼‰</font>

## <font style="color:rgb(28, 30, 33);">é™åˆ¶</font>
+ <font style="color:rgb(28, 30, 33);">ç›®å‰ä¸æ”¯æŒæœåŠ¡å™¨å‘èµ·çš„äº‹ä»¶çš„å®¢æˆ·ç«¯å›è°ƒ</font>
+ <font style="color:rgb(28, 30, 33);">å½“ä½¿ç”¨ Pydantic V2 æ—¶ï¼Œå°†ä¸ä¼šç”Ÿæˆ OpenAPI æ–‡æ¡£ã€‚FastAPI æ”¯æŒ</font>[<font style="color:rgb(28, 30, 33);">æ··åˆä½¿ç”¨ pydantic v1 å’Œ v2 å‘½åç©ºé—´</font>](https://github.com/tiangolo/fastapi/issues/10360)<font style="color:rgb(28, 30, 33);">ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§ä¸‹é¢çš„ç« èŠ‚ã€‚</font>

## <font style="color:rgb(28, 30, 33);">å®‰è£…</font>
<font style="color:rgb(28, 30, 33);">å¯¹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼š</font>

```bash
pip install --upgrade "langserve[all]" 
```

<font style="color:rgb(28, 30, 33);">æˆ–è€…å¯¹äºå®¢æˆ·ç«¯ä»£ç ï¼Œ</font>`<font style="color:rgb(28, 30, 33);">pip install "langserve[client]"</font>`<font style="color:rgb(28, 30, 33);">ï¼Œå¯¹äºæœåŠ¡å™¨ä»£ç ï¼Œ</font>`<font style="color:rgb(28, 30, 33);">pip install "langserve[server]"</font>`<font style="color:rgb(28, 30, 33);">ã€‚</font>

## <font style="color:rgb(28, 30, 33);">LangChain CLI </font><font style="color:rgb(28, 30, 33);">ğŸ› ï¸</font>
<font style="color:rgb(28, 30, 33);">ä½¿ç”¨</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">LangChain</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">CLI å¿«é€Ÿå¯åŠ¨</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">LangServe</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">é¡¹ç›®ã€‚</font>

<font style="color:rgb(28, 30, 33);">è¦ä½¿ç”¨ langchain CLIï¼Œè¯·ç¡®ä¿å·²å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ </font>`<font style="color:rgb(28, 30, 33);">langchain-cli</font>`<font style="color:rgb(28, 30, 33);">ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ </font>`<font style="color:rgb(28, 30, 33);">pip install -U langchain-cli</font>`<font style="color:rgb(28, 30, 33);"> è¿›è¡Œå®‰è£…ã€‚</font>

## <font style="color:rgb(28, 30, 33);">è®¾ç½®</font>
**<font style="color:rgb(28, 30, 33);">æ³¨æ„</font>**<font style="color:rgb(28, 30, 33);">ï¼šæˆ‘ä»¬ä½¿ç”¨</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">poetry</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">è¿›è¡Œä¾èµ–ç®¡ç†ã€‚è¯·å‚é˜… poetry</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">æ–‡æ¡£</font>](https://python-poetry.org/docs/)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">äº†è§£æ›´å¤šä¿¡æ¯ã€‚</font>

### <font style="color:rgb(28, 30, 33);">1. ä½¿ç”¨ langchain cli å‘½ä»¤åˆ›å»ºæ–°åº”ç”¨</font>
```plain
langchain app new langserve
```

### <font style="color:rgb(28, 30, 33);">2. åœ¨ add_routes ä¸­å®šä¹‰å¯è¿è¡Œå¯¹è±¡ã€‚è½¬åˆ° server.py å¹¶ç¼–è¾‘</font>
```plain
add_routes(app. NotImplemented)
```

### <font style="color:rgb(28, 30, 33);">3. ä½¿ç”¨ </font>`<font style="color:rgb(28, 30, 33);">poetry</font>`<font style="color:rgb(28, 30, 33);"> æ·»åŠ ç¬¬ä¸‰æ–¹åŒ…ï¼ˆä¾‹å¦‚ langchain-openaiã€langchain-anthropicã€langchain-mistral ç­‰ï¼‰</font>
```powershell
#å®‰è£…pipxï¼Œå‚è€ƒï¼šhttps://pipx.pypa.io/stable/installation/
pip install pipx 
#åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ï¼Œéœ€è¦é‡å¯PyCharm 
pipx ensurepath

# å®‰è£…poetryï¼Œå‚è€ƒï¼šhttps://python-poetry.org/docs/
pipx install poetry


#å®‰è£… langchain-openai åº“ï¼Œä¾‹å¦‚ï¼špoetry add [package-name]
poetry add langchain
poetry add langchain-openai 
```

### <font style="color:rgb(28, 30, 33);">4. è®¾ç½®ç›¸å…³ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼Œ</font>
```plain
export OPENAI_API_KEY="sk-..."
```

### <font style="color:rgb(28, 30, 33);">5. å¯åŠ¨æ‚¨çš„åº”ç”¨</font>
```plain
poetry run langchain serve --port=8000
```

## <font style="color:rgb(28, 30, 33);">ç¤ºä¾‹åº”ç”¨</font>
## <font style="color:rgb(28, 30, 33);">æœåŠ¡å™¨</font>
<font style="color:rgb(28, 30, 33);">ä»¥ä¸‹æ˜¯ä¸€ä¸ªéƒ¨ç½² OpenAI èŠå¤©æ¨¡å‹ï¼Œè®²è¿°æœ‰å…³ç‰¹å®šä¸»é¢˜ç¬‘è¯çš„é“¾çš„æœåŠ¡å™¨ã€‚</font>

```python
#!/usr/bin/env python
from fastapi import FastAPI
from langchain_openai import ChatOpenAI
from langserve import add_routes
app = FastAPI(
    title="LangChain æœåŠ¡å™¨",
    version="1.0",
    description="ä½¿ç”¨ Langchain çš„ Runnable æ¥å£çš„ç®€å• API æœåŠ¡å™¨",
)
add_routes(
    app,
    ChatOpenAI(model="gpt-4"),
    path="/openai",
)
if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="localhost", port=8000)
```

<font style="color:rgb(28, 30, 33);">å¦‚æœæ‚¨æ‰“ç®—ä»æµè§ˆå™¨è°ƒç”¨æ‚¨çš„ç«¯ç‚¹ï¼Œæ‚¨è¿˜éœ€è¦è®¾ç½® CORS å¤´ã€‚</font>

<font style="color:rgb(28, 30, 33);">æ‚¨å¯ä»¥ä½¿ç”¨ FastAPI çš„å†…ç½®ä¸­é—´ä»¶æ¥å®ç°ï¼š</font>

```python
from fastapi.middleware.cors import CORSMiddleware
# è®¾ç½®æ‰€æœ‰å¯ç”¨ CORS çš„æ¥æº
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
    expose_headers=["*"],
)
```

## <font style="color:rgb(28, 30, 33);">æ–‡æ¡£</font>
<font style="color:rgb(28, 30, 33);">å¦‚æœæ‚¨å·²éƒ¨ç½²ä¸Šè¿°æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„ OpenAPI æ–‡æ¡£ï¼š</font>

æ–‡æ¡£åœ°å€ï¼š[http://localhost:8000/docs](http://localhost:8000/docs)

```plain
curl localhost:8000/docs
```

<font style="color:rgb(28, 30, 33);">è¯·ç¡®ä¿</font>**<font style="color:rgb(28, 30, 33);">æ·»åŠ </font>**<font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">/docs</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">åç¼€ã€‚</font>

âš ï¸ é¦–é¡µ `/` æ²¡æœ‰è¢«**è®¾è®¡**å®šä¹‰ï¼Œå› æ­¤ `curl localhost:8000` æˆ–è®¿é—®è¯¥ URL

å°†è¿”å› 404ã€‚å¦‚æœæ‚¨æƒ³åœ¨ `/` ä¸Šæœ‰å†…å®¹ï¼Œè¯·å®šä¹‰ä¸€ä¸ªç«¯ç‚¹ `@app.get("/")`ã€‚

## <font style="color:rgb(28, 30, 33);">å®¢æˆ·ç«¯</font>
<font style="color:rgb(28, 30, 33);">Python SDK</font>

```python
from langchain.schema.runnable import RunnableMap
from langchain_core.prompts import ChatPromptTemplate
from langserve import RemoteRunnable

openai = RemoteRunnable("http://localhost:8000/openai/")
prompt = ChatPromptTemplate.from_messages(
    [("system", "ä½ æ˜¯ä¸€ä¸ªå–œæ¬¢å†™æ•…äº‹çš„åŠ©æ‰‹"), ("system", "å†™ä¸€ä¸ªæ•…äº‹ï¼Œä¸»é¢˜æ˜¯ï¼š {topic}")]
)
# å¯ä»¥å®šä¹‰è‡ªå®šä¹‰é“¾
chain = prompt | RunnableMap({
    "openai": openai
})
response = chain.batch([{"topic": "çŒ«"}])
print(response)
#[{'openai': AIMessage(content='ä»å‰ï¼Œæœ‰ä¸€ä¸ªå«åšè‚–æ©çš„ç”·å­©ï¼Œä»–åœ¨ä¸€ä¸ªå®é™çš„ä¹¡æ‘é‡Œç”Ÿæ´»ã€‚ä¸€å¤©ï¼Œä»–åœ¨å®¶çš„åé™¢å‘ç°äº†ä¸€ä¸ªå°å°çš„ï¼ŒèŒèŒçš„çŒ«å’ªã€‚è¿™åªçŒ«å’ªæœ‰ä¸€åŒå¤§å¤§çš„è“è‰²çœ¼ç›ï¼Œæ¯›è‰²å¦‚åŒæœéœèˆ¬çš„ç²‰è‰²ï¼Œçœ‹èµ·æ¥éå¸¸å¯çˆ±ã€‚\n\nè‚–æ©æŠŠè¿™åªçŒ«å’ªå¸¦å›äº†å®¶ï¼Œä»–ç»™å¥¹å–åä¸ºâ€œæ¨±èŠ±â€ï¼Œå› ä¸ºå¥¹çš„æ¯›è‰²è®©ä»–è”æƒ³åˆ°æ˜¥å¤©ç››å¼€çš„æ¨±èŠ±ã€‚è‚–æ©éå¸¸å–œæ¬¢æ¨±èŠ±ï¼Œä»–ç”¨å¿ƒç…§é¡¾å¥¹ï¼Œæ¯å¤©éƒ½ä¼šä¸ºå¥¹å‡†å¤‡æ–°é²œçš„é£Ÿç‰©å’Œæ¸…æ°´ï¼Œè¿˜ä¼šé™ªå¥¹ç©è€ï¼Œå¸¦å¥¹å»æ•£æ­¥ã€‚\n\næ¨±èŠ±ä¹Ÿéå¸¸å–œæ¬¢è‚–æ©ï¼Œå¥¹ä¼šåœ¨è‚–æ©è¯»ä¹¦çš„æ—¶å€™èººåœ¨ä»–çš„è„šè¾¹ï¼Œä¼šåœ¨ä»–ä¼¤å¿ƒçš„æ—¶å€™å®‰æ…°ä»–ï¼Œæ¯å½“è‚–æ©å›å®¶çš„æ—¶å€™ï¼Œå¥¹æ€»æ˜¯ç¬¬ä¸€ä¸ªè·‘å‡ºæ¥è¿æ¥ä»–ã€‚å¯æ˜¯ï¼Œæ¨±èŠ±æœ‰ä¸€ä¸ªç§˜å¯†ï¼Œå¥¹å…¶å®æ˜¯ä¸€åªä¼šè¯´äººè¯çš„çŒ«ã€‚\n\nè¿™ä¸ªç§˜å¯†æ˜¯åœ¨ä¸€ä¸ªæœˆåœ†çš„å¤œæ™šè¢«è‚–æ©å‘ç°çš„ã€‚é‚£å¤©æ™šä¸Šï¼Œè‚–æ©åšäº†ä¸€ä¸ªå™©æ¢¦ï¼Œä»–ä»æ¢¦ä¸­æƒŠé†’ï¼Œå‘ç°æ¨±èŠ±æ­£ååœ¨ä»–çš„åºŠè¾¹ï¼Œç”¨äººçš„è¯­è¨€å®‰æ…°ä»–ã€‚è‚–æ©ä¸€å¼€å§‹ä»¥ä¸ºè‡ªå·±åœ¨åšæ¢¦ï¼Œä½†æ˜¯å½“ä»–æ¸…é†’è¿‡æ¥ï¼Œæ¨±èŠ±è¿˜åœ¨ç»§ç»­è®²è¯ï¼Œä»–æ‰çŸ¥é“è¿™æ˜¯çœŸçš„ã€‚\n\næ¨±èŠ±å‘è‚–æ©è§£é‡Šï¼Œå¥¹æ˜¯ä¸€åªæ¥è‡ªç¥ç§˜çš„çŒ«å’ªå›½åº¦çš„ä½¿è€…ï¼Œå¥¹çš„ä»»åŠ¡æ˜¯ä¿æŠ¤å’Œå¸®åŠ©é‚£äº›å–„è‰¯å’Œçˆ±æŠ¤åŠ¨ç‰©çš„äººã€‚è‚–æ©å› ä¸ºå¯¹å¥¹çš„å–„è‰¯å’Œç…§é¡¾ï¼Œä½¿å¥¹å†³å®šå‘ä»–å±•ç°çœŸå®çš„è‡ªæˆ‘ã€‚\n\nè‚–æ©è™½ç„¶æ„Ÿåˆ°æƒŠè®¶ï¼Œä½†ä»–å¹¶æ²¡æœ‰å› æ­¤è€Œå®³æ€•æˆ–è€…æ’æ–¥æ¨±èŠ±ã€‚ä»–è§‰å¾—è¿™åªä½¿å¾—ä»–æ›´åŠ å–œæ¬¢æ¨±èŠ±ï¼Œè§‰å¾—è¿™æ˜¯ä»–ä»¬ä¹‹é—´çš„ç‰¹æ®Šçº½å¸¦ã€‚\n\nä»é‚£å¤©å¼€å§‹ï¼Œè‚–æ©å’Œæ¨±èŠ±çš„å…³ç³»å˜å¾—æ›´åŠ äº²å¯†ï¼Œä»–ä»¬åƒæœ€å¥½çš„æœ‹å‹ä¸€æ ·ï¼Œåˆ†äº«å½¼æ­¤çš„ç§˜å¯†ï¼Œä¸€èµ·åº¦è¿‡å¿«ä¹çš„æ—¶å…‰ã€‚æ¨±èŠ±ä¹Ÿç”¨å¥¹çš„æ™ºæ…§å’ŒåŠ›é‡ï¼Œå¸®åŠ©è‚–æ©è§£å†³äº†è®¸å¤šå›°æ‰°ä»–çš„é—®é¢˜ã€‚\n\nè®¸å¤šå¹´è¿‡å»äº†ï¼Œè‚–æ©é•¿å¤§äº†ï¼Œä»–ç¦»å¼€äº†ä¹¡æ‘ï¼Œå»äº†åŸå¸‚ä¸Šå¤§å­¦ã€‚ä½†æ˜¯ï¼Œæ— è®ºä»–èµ°åˆ°å“ªé‡Œï¼Œéƒ½ä¼šå¸¦ç€æ¨±èŠ±ã€‚ä»–ä»¬çš„å‹æƒ…å’Œäº’ç›¸çš„é™ªä¼´ï¼Œè®©ä»–ä»¬æ— è®ºåœ¨å“ªé‡Œï¼Œéƒ½èƒ½æ„Ÿåˆ°å®¶çš„æ¸©æš–ã€‚\n\næœ€åï¼Œè‚–æ©æˆä¸ºäº†ä¸€åä½œå®¶ï¼Œä»–å†™ä¸‹äº†è‡ªå·±å’Œæ¨±èŠ±çš„æ•…äº‹ï¼Œè¿™ä¸ªæ•…äº‹è¢«äººä»¬å¹¿ä¸ºä¼ æ’­ï¼Œè®©æ›´å¤šçš„äººçŸ¥é“äº†è¿™ä¸ªå…³äºå–„è‰¯ã€å‹æƒ…å’Œå‹‡æ°”çš„æ•…äº‹ã€‚è€Œæ¨±èŠ±ï¼Œä¹Ÿæ°¸è¿œé™ªä¼´åœ¨è‚–æ©çš„èº«è¾¹ï¼Œæˆä¸ºä»–ç”Ÿæ´»ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚\n\nè¿™å°±æ˜¯è‚–æ©å’Œæ¨±èŠ±çš„æ•…äº‹ï¼Œä¸€ä¸ªå…³äºç”·å­©å’Œä»–çš„çŒ«çš„æ•…äº‹ï¼Œå……æ»¡äº†å¥‡è¿¹ã€æ¸©æš–å’Œçˆ±ã€‚', response_metadata={'token_usage': {'completion_tokens': 1050, 'prompt_tokens': 33, 'total_tokens': 1083}, 'model_name': 'gpt-4-0613', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-c44f1624-ea75-424b-ba3d-e741baf44bda-0', usage_metadata={'input_tokens': 33, 'output_tokens': 1050, 'total_tokens': 1083})}]

```

<font style="color:rgb(28, 30, 33);">åœ¨ TypeScript ä¸­ï¼ˆéœ€è¦ LangChain.js ç‰ˆæœ¬ 0.0.166 æˆ–æ›´é«˜ï¼‰ï¼š</font>

```typescript
import { RemoteRunnable } from "@langchain/core/runnables/remote";
const chain = new RemoteRunnable({
  url: `http://localhost:8000/openai/`,
});
const result = await chain.invoke({
  topic: "cats",
});
```

<font style="color:rgb(28, 30, 33);">ä½¿ç”¨</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">requests</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„ Python ä»£ç ï¼š</font>

```python
import requests
response = requests.post(
    "http://localhost:8000/openai",
    json={'input': {'topic': 'cats'}}
)
response.json()
```

<font style="color:rgb(28, 30, 33);">æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">curl</font>`<font style="color:rgb(28, 30, 33);">ï¼š</font>

```powershell
curl --location --request POST 'http://localhost:8000/openai/stream' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "input": {
            "topic": "ç‹—"
        }
    }'
```

## <font style="color:rgb(28, 30, 33);">ç«¯ç‚¹</font>
<font style="color:rgb(28, 30, 33);">ä»¥ä¸‹ä»£ç ï¼š</font>

```python
...
add_routes(
    app,
    runnable,
    path="/my_runnable",
)
```

<font style="color:rgb(28, 30, 33);">å°†ä»¥ä¸‹ç«¯ç‚¹æ·»åŠ åˆ°æœåŠ¡å™¨ï¼š</font>

+ `<font style="color:rgb(28, 30, 33);">POST /my_runnable/invoke</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">- å¯¹å•ä¸ªè¾“å…¥è°ƒç”¨å¯è¿è¡Œé¡¹</font>
+ `<font style="color:rgb(28, 30, 33);">POST /my_runnable/batch</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">- å¯¹ä¸€æ‰¹è¾“å…¥è°ƒç”¨å¯è¿è¡Œé¡¹</font>
+ `<font style="color:rgb(28, 30, 33);">POST /my_runnable/stream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">- å¯¹å•ä¸ªè¾“å…¥è°ƒç”¨å¹¶æµå¼ä¼ è¾“è¾“å‡º</font>
+ `<font style="color:rgb(28, 30, 33);">POST /my_runnable/stream_log</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">- å¯¹å•ä¸ªè¾“å…¥è°ƒç”¨å¹¶æµå¼ä¼ è¾“è¾“å‡ºï¼Œ</font>

<font style="color:rgb(28, 30, 33);">åŒ…æ‹¬ç”Ÿæˆçš„ä¸­é—´æ­¥éª¤çš„è¾“å‡º</font>

+ `<font style="color:rgb(28, 30, 33);">POST /my_runnable/astream_events</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">- å¯¹å•ä¸ªè¾“å…¥è°ƒç”¨å¹¶åœ¨ç”Ÿæˆæ—¶æµå¼ä¼ è¾“äº‹ä»¶ï¼Œ</font>

<font style="color:rgb(28, 30, 33);">åŒ…æ‹¬æ¥è‡ªä¸­é—´æ­¥éª¤çš„äº‹ä»¶ã€‚</font>

+ `<font style="color:rgb(28, 30, 33);">GET /my_runnable/input_schema</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">- å¯è¿è¡Œé¡¹çš„è¾“å…¥çš„ JSON æ¨¡å¼</font>
+ `<font style="color:rgb(28, 30, 33);">GET /my_runnable/output_schema</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">- å¯è¿è¡Œé¡¹çš„è¾“å‡ºçš„ JSON æ¨¡å¼</font>
+ `<font style="color:rgb(28, 30, 33);">GET /my_runnable/config_schema</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">- å¯è¿è¡Œé¡¹çš„é…ç½®çš„ JSON æ¨¡å¼</font>

<font style="color:rgb(28, 30, 33);">è¿™äº›ç«¯ç‚¹ä¸</font>[<font style="color:rgb(28, 30, 33);">LangChain è¡¨è¾¾å¼è¯­è¨€æ¥å£</font>](https://python.langchain.com/docs/expression_language/interface)<font style="color:rgb(28, 30, 33);">ç›¸åŒ¹é… --</font>

<font style="color:rgb(28, 30, 33);"></font>

# <font style="color:rgb(28, 30, 33);">LangChain æœåŠ¡ç›‘æ§</font>
<font style="color:rgb(28, 30, 33);">ä¸æ„å»ºä»»ä½•ç±»å‹çš„è½¯ä»¶ä¸€æ ·ï¼Œä½¿ç”¨LLMæ„å»ºæ—¶ï¼Œæ€»ä¼šæœ‰è°ƒè¯•çš„éœ€æ±‚ã€‚æ¨¡å‹è°ƒç”¨å¯èƒ½ä¼šå¤±è´¥ï¼Œæ¨¡å‹è¾“å‡ºå¯èƒ½æ ¼å¼é”™è¯¯ï¼Œæˆ–è€…å¯èƒ½å­˜åœ¨ä¸€äº›åµŒå¥—çš„æ¨¡å‹è°ƒç”¨ï¼Œä¸æ¸…æ¥šåœ¨å“ªä¸€æ­¥å‡ºç°äº†é”™è¯¯çš„è¾“å‡ºã€‚ æœ‰ä¸‰ç§ä¸»è¦çš„è°ƒè¯•æ–¹æ³•ï¼š</font>

+ <font style="color:rgb(28, 30, 33);">è¯¦ç»†æ¨¡å¼(Verbose)ï¼šä¸ºä½ çš„é“¾ä¸­çš„â€œé‡è¦â€äº‹ä»¶æ·»åŠ æ‰“å°è¯­å¥ã€‚</font>
+ <font style="color:rgb(28, 30, 33);">è°ƒè¯•æ¨¡å¼(Debug)ï¼šä¸ºä½ çš„é“¾ä¸­çš„æ‰€æœ‰äº‹ä»¶æ·»åŠ æ—¥å¿—è®°å½•è¯­å¥ã€‚</font>
+ <font style="color:rgb(28, 30, 33);">LangSmithè·Ÿè¸ªï¼šå°†äº‹ä»¶è®°å½•åˆ°</font>[<font style="color:rgb(28, 30, 33);">LangSmith</font>](https://docs.smith.langchain.com/)<font style="color:rgb(28, 30, 33);">ï¼Œä»¥ä¾¿åœ¨é‚£é‡Œè¿›è¡Œå¯è§†åŒ–ã€‚</font>

|  | <font style="color:rgb(28, 30, 33);">è¯¦ç»†æ¨¡å¼(Verbose Mode)</font> | <font style="color:rgb(28, 30, 33);">è°ƒè¯•æ¨¡å¼(Debug Mode)</font> | <font style="color:rgb(28, 30, 33);">LangSmithè·Ÿè¸ª</font> |
| --- | --- | --- | --- |
| <font style="color:rgb(28, 30, 33);">å…è´¹</font> | âœ… | âœ… | âœ… |
| <font style="color:rgb(28, 30, 33);">ç”¨æˆ·ç•Œé¢</font> | âŒ | âŒ | âœ… |
| <font style="color:rgb(28, 30, 33);">æŒä¹…åŒ–</font> | âŒ | âŒ | âœ… |
| <font style="color:rgb(28, 30, 33);">æŸ¥çœ‹æ‰€æœ‰äº‹ä»¶</font> | âŒ | âœ… | âœ… |
| <font style="color:rgb(28, 30, 33);">æŸ¥çœ‹â€œé‡è¦â€äº‹ä»¶</font> | âœ… | âŒ | âœ… |
| <font style="color:rgb(28, 30, 33);">æœ¬åœ°è¿è¡Œ</font> | âœ… | âœ… | âŒ |


## LangSmith Tracing(è·Ÿè¸ª)
<font style="color:rgb(28, 30, 33);">ä½¿ç”¨LangChainæ„å»ºçš„è®¸å¤šåº”ç”¨ç¨‹åºå°†åŒ…å«å¤šä¸ªæ­¥éª¤ï¼Œå…¶ä¸­åŒ…å«å¤šæ¬¡LLMè°ƒç”¨ã€‚ éšç€è¿™äº›åº”ç”¨ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œèƒ½å¤Ÿæ£€æŸ¥é“¾æˆ–ä»£ç†å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆå˜å¾—è‡³å…³é‡è¦ã€‚ è¿™æ ·åšçš„æœ€ä½³æ–¹å¼æ˜¯ä½¿ç”¨</font>[<font style="color:rgb(28, 30, 33);">LangSmith</font>](https://smith.langchain.com/)<font style="color:rgb(28, 30, 33);">ã€‚ åœ¨ä¸Šé¢çš„é“¾æ¥ä¸Šæ³¨å†Œåï¼Œè¯·ç¡®ä¿è®¾ç½®ä½ çš„ç¯å¢ƒå˜é‡ä»¥å¼€å§‹è®°å½•è·Ÿè¸ªï¼š</font>

LangSmithå®˜ç½‘ï¼š[https://smith.langchain.com/](https://smith.langchain.com/)

tavilyå®˜ç½‘ï¼š[https://tavily.com/](https://tavily.com/)

```powershell
#windowså¯¼å…¥ç¯å¢ƒå˜é‡
#é…ç½®LangSmith ç›‘æ§å¼€å…³ï¼Œtrueå¼€å¯ï¼Œfalseå…³é—­
setx LANGCHAIN_TRACING_V2 "true"
#é…ç½® LangSmith api key
setx LANGCHAIN_API_KEY "..."
#é…ç½® taily api key
setx TAVILY_API_KEY "..."

#mac å¯¼å…¥ç¯å¢ƒå˜é‡
export LANGCHAIN_TRACING_V2="true"
export LANGCHAIN_API_KEY="..."
export TAVILY_API_KEY="..."
```

<font style="color:rgb(28, 30, 33);">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä»£ç†ï¼Œå¹¶ä¸”å¸Œæœ›å¯è§†åŒ–å®ƒæ‰€é‡‡å–çš„æ“ä½œå’Œæ¥æ”¶åˆ°çš„å·¥å…·è¾“å‡ºã€‚åœ¨æ²¡æœ‰ä»»ä½•è°ƒè¯•çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ï¼š</font>

```python
import os
from langchain_openai import ChatOpenAI
from langchain.agents import AgentExecutor, create_tool_calling_agent
from langchain_community.tools.tavily_search import TavilySearchResults
from langchain_core.prompts import ChatPromptTemplate
from langchain.globals import set_verbose

llm = ChatOpenAI(model="gpt-4o")
tools = [TavilySearchResults(max_results=1)]
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚",
        ),
        ("placeholder", "{chat_history}"),
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ]
)
# æ„å»ºå·¥å…·ä»£ç†
agent = create_tool_calling_agent(llm, tools, prompt)
set_verbose(True)
# é€šè¿‡ä¼ å…¥ä»£ç†å’Œå·¥å…·æ¥åˆ›å»ºä»£ç†æ‰§è¡Œå™¨
agent_executor = AgentExecutor(agent=agent, tools=tools)
agent_executor.invoke(
    {"input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"}
)
```

```json
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚'}
```

<font style="color:rgb(28, 30, 33);">æˆ‘ä»¬æ²¡æœ‰å¾—åˆ°å¤ªå¤šè¾“å‡ºï¼Œä½†ç”±äºæˆ‘ä»¬è®¾ç½®äº†LangSmithï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°çœ‹åˆ°å‘ç”Ÿäº†ä»€ä¹ˆï¼š </font>[https://smith.langchain.com/public/a89ff88f-9ddc-4757-a395-3a1b365655bf/r](https://smith.langchain.com/public/a89ff88f-9ddc-4757-a395-3a1b365655bf/r)

## <font style="color:rgb(28, 30, 33);">Verbose(è¯¦ç»†æ—¥å¿—æ‰“å°)</font>
<font style="color:rgb(28, 30, 33);">å¦‚æœä½ åœ¨Jupyterç¬”è®°æœ¬ä¸­è¿›è¡ŒåŸå‹è®¾è®¡æˆ–è¿è¡ŒPythonè„šæœ¬ï¼Œæ‰“å°å‡ºé“¾è¿è¡Œçš„ä¸­é—´æ­¥éª¤å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥ä»¥ä¸åŒç¨‹åº¦çš„è¯¦ç»†ç¨‹åº¦å¯ç”¨æ‰“å°ã€‚ æ³¨æ„ï¼šå³ä½¿å¯ç”¨äº†LangSmithï¼Œè¿™äº›ä»ç„¶æœ‰æ•ˆï¼Œå› æ­¤ä½ å¯ä»¥åŒæ—¶æ‰“å¼€å¹¶è¿è¡Œå®ƒä»¬ã€‚</font>

`set_verbose(True)`

<font style="color:rgb(28, 30, 33);">è®¾ç½®</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">verbose</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æ ‡å¿—å°†ä»¥ç¨å¾®æ›´æ˜“è¯»çš„æ ¼å¼æ‰“å°å‡ºè¾“å…¥å’Œè¾“å‡ºï¼Œå¹¶å°†è·³è¿‡è®°å½•æŸäº›åŸå§‹è¾“å‡ºï¼ˆä¾‹å¦‚ LLM è°ƒç”¨çš„ä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼‰ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä¸“æ³¨äºåº”ç”¨ç¨‹åºé€»è¾‘ã€‚</font>

```python
from langchain.globals import set_verbose
set_verbose(True)
agent_executor = AgentExecutor(agent=agent, tools=tools)
agent_executor.invoke(
    {"input": "Who directed the 2023 film Oppenheimer and what is their age in days?"}
)
```

```powershell
> Entering new AgentExecutor chain...

Invoking: `tavily_search_results_json` with `{'query': '2023 movie Oppenheimer director'}`


[{'url': 'https://www.imdb.com/title/tt15398776/fullcredits/', 'content': 'Oppenheimer (2023) cast and crew credits, including actors, actresses, directors, writers and more. Menu. ... director of photography: behind-the-scenes Jason Gary ... best boy grip ... film loader Luc Poullain ... aerial coordinator'}]
Invoking: `tavily_search_results_json` with `{'query': 'Christopher Nolan age'}`


[{'url': 'https://www.nme.com/news/film/christopher-nolan-fans-are-celebrating-his-54th-birthday-youve-changed-things-forever-3779396', 'content': "Christopher Nolan is 54 Still my fave bit of Nolan trivia: Joey Pantoliano on creating Ralph Cifaretto's look in The Sopranos: 'The wig I had them build as an homage to Chris Nolan, I like ..."}]2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰æ‰§å¯¼ã€‚ä»–ç›®å‰54å²ã€‚

> Finished chain.
```

```json
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚'}
```



## <font style="color:rgb(28, 30, 33);">Debug(è°ƒè¯•æ—¥å¿—æ‰“å°)</font>
`set_debug(True)`

<font style="color:rgb(28, 30, 33);">è®¾ç½®å…¨å±€çš„</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">debug</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æ ‡å¿—å°†å¯¼è‡´æ‰€æœ‰å…·æœ‰å›è°ƒæ”¯æŒçš„ LangChain ç»„ä»¶ï¼ˆé“¾ã€æ¨¡å‹ã€ä»£ç†ã€å·¥å…·ã€æ£€ç´¢å™¨ï¼‰æ‰“å°å®ƒä»¬æ¥æ”¶çš„è¾“å…¥å’Œç”Ÿæˆçš„è¾“å‡ºã€‚è¿™æ˜¯æœ€è¯¦ç»†çš„è®¾ç½®ï¼Œå°†å®Œå…¨è®°å½•åŸå§‹è¾“å…¥å’Œè¾“å‡ºã€‚</font>

```python
from langchain.globals import set_debug
# æ„å»ºå·¥å…·ä»£ç†
agent = create_tool_calling_agent(llm, tools, prompt)
#æ‰“å°è°ƒè¯•æ—¥å¿—
set_debug(True)
#ä¸è¾“å‡ºè¯¦ç»†æ—¥å¿—
set_verbose(False)
# é€šè¿‡ä¼ å…¥ä»£ç†å’Œå·¥å…·æ¥åˆ›å»ºä»£ç†æ‰§è¡Œå™¨
agent_executor = AgentExecutor(agent=agent, tools=tools)
agent_executor.invoke(
    {"input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"}
)
```

```powershell
[chain/start] [chain:AgentExecutor] Entering Chain run with input:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] Entering Chain run with input:
{
  "input": ""
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] [1ms] Exiting Chain run with output:
{
  "output": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] [4ms] Exiting Chain run with output:
{
  "agent_scratchpad": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] [10ms] Exiting Chain run with output:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ",
  "intermediate_steps": [],
  "agent_scratchpad": []
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] Entering Prompt run with input:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ",
  "intermediate_steps": [],
  "agent_scratchpad": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[outputs]
[llm/start] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] Entering LLM run with input:
{
  "prompts": [
    "System: ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚\nHuman: è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"
  ]
}
[llm/end] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] [1.81s] Exiting LLM run with output:
{
  "generations": [
    [
      {
        "text": "",
        "generation_info": {
          "finish_reason": "tool_calls",
          "model_name": "gpt-4o-2024-05-13",
          "system_fingerprint": "fp_4e2b2da518"
        },
        "type": "ChatGenerationChunk",
        "message": {
          "lc": 1,
          "type": "constructor",
          "id": [
            "langchain",
            "schema",
            "messages",
            "AIMessageChunk"
          ],
          "kwargs": {
            "content": "",
            "additional_kwargs": {
              "tool_calls": [
                {
                  "index": 0,
                  "id": "call_Rhv2KLzFTU0XhJso5F79EiUp",
                  "function": {
                    "arguments": "{\"query\":\"2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹å¯¼æ¼”\"}",
                    "name": "tavily_search_results_json"
                  },
                  "type": "function"
                }
              ]
            },
            "response_metadata": {
              "finish_reason": "tool_calls",
              "model_name": "gpt-4o-2024-05-13",
              "system_fingerprint": "fp_4e2b2da518"
            },
            "type": "AIMessageChunk",
            "id": "run-cbeb35e8-b4ee-4c78-b663-e338ef90382d",
            "tool_calls": [
              {
                "name": "tavily_search_results_json",
                "args": {
                  "query": "2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹å¯¼æ¼”"
                },
                "id": "call_Rhv2KLzFTU0XhJso5F79EiUp",
                "type": "tool_call"
              }
            ],
            "tool_call_chunks": [
              {
                "name": "tavily_search_results_json",
                "args": "{\"query\":\"2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹å¯¼æ¼”\"}",
                "id": "call_Rhv2KLzFTU0XhJso5F79EiUp",
                "index": 0,
                "type": "tool_call_chunk"
              }
            ],
            "invalid_tool_calls": []
          }
        }
      }
    ]
  ],
  "llm_output": null,
  "run": null
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] Entering Parser run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] [2ms] Exiting Parser run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence] [1.85s] Exiting Chain run with output:
[outputs]
[tool/start] [chain:AgentExecutor > tool:tavily_search_results_json] Entering Tool run with input:
"{'query': '2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹å¯¼æ¼”'}"
[tool/end] [chain:AgentExecutor > tool:tavily_search_results_json] [2.06s] Exiting Tool run with output:
"[{'url': 'https://baike.baidu.com/item/å¥¥æœ¬æµ·é»˜/58802734', 'content': 'ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°è‡ªç¼–è‡ªå¯¼çš„ï¼Œç”±åŸºé‡Œå®‰Â·å¢¨è²ä¸»æ¼”çš„ä¼ è®°ç”µå½±ï¼Œè¯¥ç‰‡äº2023å¹´7æœˆ21æ—¥åœ¨åŒ—ç¾ä¸Šæ˜ ï¼Œ8æœˆ30æ—¥åœ¨ä¸­å›½å†…åœ°ä¸Šæ˜ ï¼Œ2024å¹´3æœˆ29æ—¥åœ¨æ—¥æœ¬ä¸Šæ˜ ã€‚è¯¥ç‰‡æ”¹ç¼–è‡ªKai Birdã€Martin J. Sherwinçš„ã€Šç¾å›½æ™®ç½—ç±³ä¿®æ–¯ï¼šå¥¥æœ¬æµ·é»˜çš„èƒœä¸æ‚²ã€‹ï¼Œå½±ç‰‡ã€Šå¥¥æœ¬æµ·é»˜ã€‹è®²è¿°äº†ç¾å›½"åŸå­å¼¹ä¹‹çˆ¶"ç½—ä¼¯ç‰¹Â· ...'}]"
[chain/start] [chain:AgentExecutor > chain:RunnableSequence] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] Entering Chain run with input:
{
  "input": ""
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] [1ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] [4ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] [10ms] Exiting Chain run with output:
[outputs]
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] Entering Prompt run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[outputs]
[llm/start] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] Entering LLM run with input:
{
  "prompts": [
    "System: ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚\nHuman: è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ\nAI: \nTool: [{\"url\": \"https://baike.baidu.com/item/å¥¥æœ¬æµ·é»˜/58802734\", \"content\": \"ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°è‡ªç¼–è‡ªå¯¼çš„ï¼Œç”±åŸºé‡Œå®‰Â·å¢¨è²ä¸»æ¼”çš„ä¼ è®°ç”µå½±ï¼Œè¯¥ç‰‡äº2023å¹´7æœˆ21æ—¥åœ¨åŒ—ç¾ä¸Šæ˜ ï¼Œ8æœˆ30æ—¥åœ¨ä¸­å›½å†…åœ°ä¸Šæ˜ ï¼Œ2024å¹´3æœˆ29æ—¥åœ¨æ—¥æœ¬ä¸Šæ˜ ã€‚è¯¥ç‰‡æ”¹ç¼–è‡ªKai Birdã€Martin J. Sherwinçš„ã€Šç¾å›½æ™®ç½—ç±³ä¿®æ–¯ï¼šå¥¥æœ¬æµ·é»˜çš„èƒœä¸æ‚²ã€‹ï¼Œå½±ç‰‡ã€Šå¥¥æœ¬æµ·é»˜ã€‹è®²è¿°äº†ç¾å›½\\\"åŸå­å¼¹ä¹‹çˆ¶\\\"ç½—ä¼¯ç‰¹Â· ...\"}]"
  ]
}
[llm/end] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] [1.39s] Exiting LLM run with output:
{
  "generations": [
    [
      {
        "text": "2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹çš„å¯¼æ¼”æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ã€‚æ¥ä¸‹æ¥æˆ‘å°†æŸ¥è¯¢ä»–çš„å¹´é¾„ã€‚",
        "generation_info": {
          "finish_reason": "tool_calls",
          "model_name": "gpt-4o-2024-05-13",
          "system_fingerprint": "fp_4e2b2da518"
        },
        "type": "ChatGenerationChunk",
        "message": {
          "lc": 1,
          "type": "constructor",
          "id": [
            "langchain",
            "schema",
            "messages",
            "AIMessageChunk"
          ],
          "kwargs": {
            "content": "2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹çš„å¯¼æ¼”æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ã€‚æ¥ä¸‹æ¥æˆ‘å°†æŸ¥è¯¢ä»–çš„å¹´é¾„ã€‚",
            "additional_kwargs": {
              "tool_calls": [
                {
                  "index": 0,
                  "id": "call_QuKQUKd6YLsgTgZeYcWpk2lN",
                  "function": {
                    "arguments": "{\"query\":\"å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å¹´é¾„\"}",
                    "name": "tavily_search_results_json"
                  },
                  "type": "function"
                }
              ]
            },
            "response_metadata": {
              "finish_reason": "tool_calls",
              "model_name": "gpt-4o-2024-05-13",
              "system_fingerprint": "fp_4e2b2da518"
            },
            "type": "AIMessageChunk",
            "id": "run-b7ee6125-1af5-4073-b81e-076a859755bd",
            "tool_calls": [
              {
                "name": "tavily_search_results_json",
                "args": {
                  "query": "å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å¹´é¾„"
                },
                "id": "call_QuKQUKd6YLsgTgZeYcWpk2lN",
                "type": "tool_call"
              }
            ],
            "tool_call_chunks": [
              {
                "name": "tavily_search_results_json",
                "args": "{\"query\":\"å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å¹´é¾„\"}",
                "id": "call_QuKQUKd6YLsgTgZeYcWpk2lN",
                "index": 0,
                "type": "tool_call_chunk"
              }
            ],
            "invalid_tool_calls": []
          }
        }
      }
    ]
  ],
  "llm_output": null,
  "run": null
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] Entering Parser run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] [1ms] Exiting Parser run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence] [1.43s] Exiting Chain run with output:
[outputs]
[tool/start] [chain:AgentExecutor > tool:tavily_search_results_json] Entering Tool run with input:
"{'query': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å¹´é¾„'}"
[tool/end] [chain:AgentExecutor > tool:tavily_search_results_json] [2.89s] Exiting Tool run with output:
"[{'url': 'https://baike.baidu.com/item/å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°/5306405', 'content': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰ï¼Œ1970å¹´7æœˆ30æ—¥å‡ºç”Ÿäºè‹±å›½ä¼¦æ•¦ï¼Œå¯¼æ¼”ã€ç¼–å‰§ã€åˆ¶ç‰‡äººã€‚1998å¹´4æœˆ24æ—¥å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°æ‹æ‘„çš„é¦–éƒ¨æ•…äº‹ç‰‡ã€Šè¿½éšã€‹åœ¨æ—§é‡‘å±±ç”µå½±èŠ‚ä¸Šæ˜ ã€‚2000å¹´ï¼Œå…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡­å€Ÿç€ä»–çš„ã€Šè®°å¿†ç¢ç‰‡ã€‹ä¸ºä»–è·å¾—ç¬¬74å±Šå¥¥æ–¯å¡çš„æåã€‚2005å¹´ï¼Œæ‰§å¯¼ã€Šè™è ä¾ ã€‹ä¸‰éƒ¨æ›²ç³»åˆ—é¦–éƒ¨ç”µå½± ...'}]"
[chain/start] [chain:AgentExecutor > chain:RunnableSequence] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] Entering Chain run with input:
{
  "input": ""
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] [1ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] [4ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] [9ms] Exiting Chain run with output:
[outputs]
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] Entering Prompt run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] [2ms] Exiting Prompt run with output:
[outputs]
[llm/start] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] Entering LLM run with input:
{
  "prompts": [
    "System: ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚\nHuman: è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ\nAI: \nTool: [{\"url\": \"https://baike.baidu.com/item/å¥¥æœ¬æµ·é»˜/58802734\", \"content\": \"ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°è‡ªç¼–è‡ªå¯¼çš„ï¼Œç”±åŸºé‡Œå®‰Â·å¢¨è²ä¸»æ¼”çš„ä¼ è®°ç”µå½±ï¼Œè¯¥ç‰‡äº2023å¹´7æœˆ21æ—¥åœ¨åŒ—ç¾ä¸Šæ˜ ï¼Œ8æœˆ30æ—¥åœ¨ä¸­å›½å†…åœ°ä¸Šæ˜ ï¼Œ2024å¹´3æœˆ29æ—¥åœ¨æ—¥æœ¬ä¸Šæ˜ ã€‚è¯¥ç‰‡æ”¹ç¼–è‡ªKai Birdã€Martin J. Sherwinçš„ã€Šç¾å›½æ™®ç½—ç±³ä¿®æ–¯ï¼šå¥¥æœ¬æµ·é»˜çš„èƒœä¸æ‚²ã€‹ï¼Œå½±ç‰‡ã€Šå¥¥æœ¬æµ·é»˜ã€‹è®²è¿°äº†ç¾å›½\\\"åŸå­å¼¹ä¹‹çˆ¶\\\"ç½—ä¼¯ç‰¹Â· ...\"}]\nAI: 2023å¹´ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹çš„å¯¼æ¼”æ˜¯å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ã€‚æ¥ä¸‹æ¥æˆ‘å°†æŸ¥è¯¢ä»–çš„å¹´é¾„ã€‚\nTool: [{\"url\": \"https://baike.baidu.com/item/å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°/5306405\", \"content\": \"å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰ï¼Œ1970å¹´7æœˆ30æ—¥å‡ºç”Ÿäºè‹±å›½ä¼¦æ•¦ï¼Œå¯¼æ¼”ã€ç¼–å‰§ã€åˆ¶ç‰‡äººã€‚1998å¹´4æœˆ24æ—¥å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°æ‹æ‘„çš„é¦–éƒ¨æ•…äº‹ç‰‡ã€Šè¿½éšã€‹åœ¨æ—§é‡‘å±±ç”µå½±èŠ‚ä¸Šæ˜ ã€‚2000å¹´ï¼Œå…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡­å€Ÿç€ä»–çš„ã€Šè®°å¿†ç¢ç‰‡ã€‹ä¸ºä»–è·å¾—ç¬¬74å±Šå¥¥æ–¯å¡çš„æåã€‚2005å¹´ï¼Œæ‰§å¯¼ã€Šè™è ä¾ ã€‹ä¸‰éƒ¨æ›²ç³»åˆ—é¦–éƒ¨ç”µå½± ...\"}]"
  ]
}
[llm/end] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] [885ms] Exiting LLM run with output:
{
  "generations": [
    [
      {
        "text": "å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ2023å¹´ï¼‰ï¼Œä»–53å²ã€‚",
        "generation_info": {
          "finish_reason": "stop",
          "model_name": "gpt-4o-2024-05-13",
          "system_fingerprint": "fp_4e2b2da518"
        },
        "type": "ChatGenerationChunk",
        "message": {
          "lc": 1,
          "type": "constructor",
          "id": [
            "langchain",
            "schema",
            "messages",
            "AIMessageChunk"
          ],
          "kwargs": {
            "content": "å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ2023å¹´ï¼‰ï¼Œä»–53å²ã€‚",
            "response_metadata": {
              "finish_reason": "stop",
              "model_name": "gpt-4o-2024-05-13",
              "system_fingerprint": "fp_4e2b2da518"
            },
            "type": "AIMessageChunk",
            "id": "run-0cc2156a-5a9d-41c2-b8bc-ecb2a291f408",
            "tool_calls": [],
            "invalid_tool_calls": []
          }
        }
      }
    ]
  ],
  "llm_output": null,
  "run": null
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] Entering Parser run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > parser:ToolsAgentOutputParser] [1ms] Exiting Parser run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence] [914ms] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor] [9.25s] Exiting Chain run with output:
{
  "output": "å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ2023å¹´ï¼‰ï¼Œä»–53å²ã€‚"
}
```

```json
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æ ¹æ®å½“å‰æ—¶é—´ï¼ˆ2023å¹´ï¼‰ï¼Œä»–53å²ã€‚'}
```

---



