**ç¤ºä¾‹ä»£ç **

[langchain-lcel.ppt](https://www.yuque.com/attachments/yuque/0/2025/ppt/1387387/1745159935268-f4bd8ff3-2214-4a4f-9149-1a01483bd57e.ppt)

_<font style="color:#DF2A3F;">æ³¨ï¼šå°†pptåç¼€åæ”¹ä¸ºzipåè§£å‹</font>_

_<font style="color:#DF2A3F;"></font>_

pythonç‰ˆæœ¬ï¼š3.12.4

**åˆ†äº«å†…å®¹**

1. LCELä»‹ç»
2. Runable interface
3. Stream(æµ)
4. Stream events(äº‹ä»¶æµ)

### <font style="color:rgb(0, 0, 0);">LCELä»‹ç»</font>
<font style="color:rgb(0, 0, 0);">LCEL(LangChain Expression Language) æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥ä½œæµç¼–æ’å·¥å…·ï¼Œå¯ä»¥ä»åŸºæœ¬ç»„ä»¶æ„å»ºå¤æ‚ä»»åŠ¡é“¾æ¡(chain)ï¼Œå¹¶æ”¯æŒè¯¸å¦‚æµå¼å¤„ç†ã€å¹¶è¡Œå¤„ç†å’Œæ—¥å¿—è®°å½•ç­‰å¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚</font>

<font style="color:rgb(28, 30, 33);"> LCEL ä»ç¬¬ä¸€å¤©èµ·å°±è¢«è®¾è®¡ä¸º</font>**<font style="color:rgb(28, 30, 33);">æ”¯æŒå°†åŸå‹æŠ•å…¥ç”Ÿäº§ï¼Œæ— éœ€æ›´æ”¹ä»£ç </font>**<font style="color:rgb(28, 30, 33);">ï¼Œä»æœ€ç®€å•çš„â€œæç¤º + LLMâ€é“¾åˆ°æœ€å¤æ‚çš„é“¾ï¼ˆæˆ‘ä»¬å·²ç»çœ‹åˆ°æœ‰äººæˆåŠŸåœ°åœ¨ç”Ÿäº§ä¸­è¿è¡Œäº†åŒ…å«æ•°ç™¾æ­¥çš„ LCEL é“¾ï¼‰ã€‚ä»¥ä¸‹æ˜¯æ‚¨å¯èƒ½æƒ³è¦ä½¿ç”¨ LCEL çš„ä¸€äº›åŸå› çš„å‡ ä¸ªäº®ç‚¹ï¼š</font>

**<font style="color:rgb(28, 30, 33);">ä¸€æµçš„æµå¼æ”¯æŒ</font>**<font style="color:rgb(28, 30, 33);"> å½“æ‚¨ä½¿ç”¨ LCEL æ„å»ºé“¾æ—¶ï¼Œæ‚¨å°†è·å¾—å¯èƒ½çš„æœ€ä½³æ—¶é—´åˆ°ç¬¬ä¸€ä¸ªæ ‡è®°ï¼ˆç›´åˆ°è¾“å‡ºçš„ç¬¬ä¸€å—å†…å®¹å‡ºç°æ‰€ç»è¿‡çš„æ—¶é—´ï¼‰ã€‚å¯¹äºæŸäº›é“¾ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ç›´æ¥ä» LLM æµå¼ä¼ è¾“æ ‡è®°åˆ°æµå¼è¾“å‡ºè§£æå™¨ï¼Œæ‚¨å°†ä»¥ä¸ LLM æä¾›ç¨‹åºè¾“å‡ºåŸå§‹æ ‡è®°çš„é€Ÿç‡ç›¸åŒçš„é€Ÿåº¦è·å¾—è§£æçš„å¢é‡è¾“å‡ºå—ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">å¼‚æ­¥æ”¯æŒ</font>**<font style="color:rgb(28, 30, 33);"> ä½¿ç”¨ LCEL æ„å»ºçš„ä»»ä½•é“¾éƒ½å¯ä»¥ä½¿ç”¨åŒæ­¥ APIï¼ˆä¾‹å¦‚ï¼Œåœ¨æ‚¨çš„ Jupyter ç¬”è®°æœ¬ä¸­è¿›è¡ŒåŸå‹è®¾è®¡ï¼‰ä»¥åŠå¼‚æ­¥ APIï¼ˆä¾‹å¦‚ï¼Œåœ¨ </font>[<font style="color:rgb(28, 30, 33);">LangServe</font>](http://www.aidoczh.com/langchain/v0.2/docs/langserve/)<font style="color:rgb(28, 30, 33);"> æœåŠ¡å™¨ä¸­ï¼‰è¿›è¡Œè°ƒç”¨ã€‚è¿™ä½¿å¾—å¯ä»¥åœ¨åŸå‹å’Œç”Ÿäº§ä¸­ä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œå…·æœ‰å‡ºè‰²çš„æ€§èƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨åŒä¸€æœåŠ¡å™¨ä¸­å¤„ç†è®¸å¤šå¹¶å‘è¯·æ±‚ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">ä¼˜åŒ–çš„å¹¶è¡Œæ‰§è¡Œ</font>**<font style="color:rgb(28, 30, 33);"> æ¯å½“æ‚¨çš„ LCEL é“¾å…·æœ‰å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„æ­¥éª¤æ—¶ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä»å¤šä¸ªæ£€ç´¢å™¨ä¸­è·å–æ–‡æ¡£ï¼‰ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ— è®ºæ˜¯åœ¨åŒæ­¥æ¥å£è¿˜æ˜¯å¼‚æ­¥æ¥å£ä¸­ï¼Œä»¥è·å¾—å¯èƒ½çš„æœ€å°å»¶è¿Ÿã€‚ </font>

**<font style="color:rgb(28, 30, 33);">é‡è¯•å’Œå›é€€</font>**<font style="color:rgb(28, 30, 33);"> ä¸º LCEL é“¾çš„ä»»ä½•éƒ¨åˆ†é…ç½®é‡è¯•å’Œå›é€€ã€‚è¿™æ˜¯ä½¿æ‚¨çš„é“¾åœ¨è§„æ¨¡ä¸Šæ›´å¯é çš„å¥½æ–¹æ³•ã€‚æˆ‘ä»¬ç›®å‰æ­£åœ¨åŠªåŠ›ä¸ºé‡è¯•/å›é€€æ·»åŠ æµå¼æ”¯æŒï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥è·å¾—é¢å¤–çš„å¯é æ€§è€Œæ— éœ€ä»»ä½•å»¶è¿Ÿæˆæœ¬ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">è®¿é—®ä¸­é—´ç»“æœ</font>**<font style="color:rgb(28, 30, 33);"> å¯¹äºæ›´å¤æ‚çš„é“¾ï¼Œè®¿é—®ä¸­é—´æ­¥éª¤çš„ç»“æœé€šå¸¸éå¸¸æœ‰ç”¨ï¼Œå³ä½¿åœ¨ç”Ÿæˆæœ€ç»ˆè¾“å‡ºä¹‹å‰ã€‚è¿™å¯ä»¥ç”¨äºè®©æœ€ç»ˆç”¨æˆ·çŸ¥é“æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œç”šè‡³åªæ˜¯ç”¨äºè°ƒè¯•æ‚¨çš„é“¾ã€‚æ‚¨å¯ä»¥æµå¼ä¼ è¾“ä¸­é—´ç»“æœï¼Œå¹¶ä¸”åœ¨æ¯ä¸ª </font>[<font style="color:rgb(28, 30, 33);">LangServe</font>](http://www.aidoczh.com/langchain/v0.2/docs/langserve/)<font style="color:rgb(28, 30, 33);"> æœåŠ¡å™¨ä¸Šéƒ½å¯ä»¥ä½¿ç”¨ã€‚ </font>

**<font style="color:rgb(28, 30, 33);">è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼</font>**<font style="color:rgb(28, 30, 33);"> è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼ä¸ºæ¯ä¸ª LCEL é“¾æä¾›äº†ä»é“¾çš„ç»“æ„æ¨æ–­å‡ºçš„ Pydantic å’Œ JSONSchema æ¨¡å¼ã€‚è¿™å¯ç”¨äºéªŒè¯è¾“å…¥å’Œè¾“å‡ºï¼Œå¹¶ä¸”æ˜¯ LangServe çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚</font>

### <font style="color:rgb(28, 30, 33);">Runable interface</font>
<font style="color:rgb(28, 30, 33);">ä¸ºäº†å°½å¯èƒ½ç®€åŒ–åˆ›å»ºè‡ªå®šä¹‰é“¾çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ª</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">"Runnable"</font>](https://api.python.langchain.com/en/stable/runnables/langchain_core.runnables.base.Runnable.html#langchain_core.runnables.base.Runnable)<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">åè®®ã€‚è®¸å¤š LangChain ç»„ä»¶éƒ½å®ç°äº†</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">Runnable</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">åè®®ï¼ŒåŒ…æ‹¬èŠå¤©æ¨¡å‹ã€LLMsã€è¾“å‡ºè§£æå™¨ã€æ£€ç´¢å™¨ã€æç¤ºæ¨¡æ¿ç­‰ç­‰ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›æœ‰ç”¨çš„åŸºæœ¬ç»„ä»¶å¯ç”¨äºå¤„ç†å¯è¿è¡Œå¯¹è±¡ï¼Œæ‚¨å¯ä»¥åœ¨ä¸‹é¢äº†è§£æ›´å¤šã€‚ è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œå¯ä»¥è½»æ¾å®šä¹‰è‡ªå®šä¹‰é“¾ï¼Œå¹¶ä»¥æ ‡å‡†æ–¹å¼è°ƒç”¨å®ƒä»¬ã€‚ æ ‡å‡†æ¥å£åŒ…æ‹¬ï¼š</font>

+ [<font style="color:rgb(28, 30, 33);">stream</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#stream)<font style="color:rgb(28, 30, 33);">: è¿”å›å“åº”çš„æ•°æ®å—</font>
+ [<font style="color:rgb(28, 30, 33);">invoke</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#invoke)<font style="color:rgb(28, 30, 33);">: å¯¹è¾“å…¥è°ƒç”¨é“¾</font>
+ [<font style="color:rgb(28, 30, 33);">batch</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#batch)<font style="color:rgb(28, 30, 33);">: å¯¹è¾“å…¥åˆ—è¡¨è°ƒç”¨é“¾ </font>

<font style="color:rgb(28, 30, 33);">è¿™äº›è¿˜æœ‰ç›¸åº”çš„å¼‚æ­¥æ–¹æ³•ï¼Œåº”è¯¥ä¸ </font>[<font style="color:rgb(28, 30, 33);">asyncio</font>](https://docs.python.org/3/library/asyncio.html)<font style="color:rgb(28, 30, 33);"> ä¸€èµ·ä½¿ç”¨ </font>`<font style="color:rgb(28, 30, 33);">await</font>`<font style="color:rgb(28, 30, 33);"> è¯­æ³•ä»¥å®ç°å¹¶å‘ï¼š</font>

+ `<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);">: å¼‚æ­¥è¿”å›å“åº”çš„æ•°æ®å—</font>
+ `<font style="color:rgb(28, 30, 33);">ainvoke</font>`<font style="color:rgb(28, 30, 33);">: å¼‚æ­¥å¯¹è¾“å…¥è°ƒç”¨é“¾</font>
+ `<font style="color:rgb(28, 30, 33);">abatch</font>`<font style="color:rgb(28, 30, 33);">: å¼‚æ­¥å¯¹è¾“å…¥åˆ—è¡¨è°ƒç”¨é“¾</font>
+ `<font style="color:rgb(28, 30, 33);">astream_log</font>`<font style="color:rgb(28, 30, 33);">: å¼‚æ­¥è¿”å›ä¸­é—´æ­¥éª¤ï¼Œä»¥åŠæœ€ç»ˆå“åº”</font>
+ `<font style="color:rgb(28, 30, 33);">astream_events</font>`<font style="color:rgb(28, 30, 33);">:</font><font style="color:rgb(28, 30, 33);"> </font>**<font style="color:rgb(28, 30, 33);">beta</font>**<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">æµå¼ä¼ è¾“é“¾ä¸­å‘ç”Ÿçš„äº‹ä»¶ï¼ˆåœ¨</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">langchain-core</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">0.1.14 ä¸­å¼•å…¥ï¼‰</font><font style="color:rgb(28, 30, 33);"> </font>

**<font style="color:rgb(28, 30, 33);">è¾“å…¥ç±»å‹</font>**<font style="color:rgb(28, 30, 33);"> å’Œ </font>**<font style="color:rgb(28, 30, 33);">è¾“å‡ºç±»å‹</font>**<font style="color:rgb(28, 30, 33);"> å› ç»„ä»¶è€Œå¼‚ï¼š </font>

| <font style="color:rgb(28, 30, 33);">ç»„ä»¶</font> | <font style="color:rgb(28, 30, 33);">è¾“å…¥ç±»å‹</font> | <font style="color:rgb(28, 30, 33);">è¾“å‡ºç±»å‹</font> |
| --- | --- | --- |
| <font style="color:rgb(28, 30, 33);">æç¤º</font> | <font style="color:rgb(28, 30, 33);">å­—å…¸</font> | <font style="color:rgb(28, 30, 33);">æç¤ºå€¼</font> |
| <font style="color:rgb(28, 30, 33);">èŠå¤©æ¨¡å‹</font> | <font style="color:rgb(28, 30, 33);">å•ä¸ªå­—ç¬¦ä¸²ã€èŠå¤©æ¶ˆæ¯åˆ—è¡¨æˆ–æç¤ºå€¼</font> | <font style="color:rgb(28, 30, 33);">èŠå¤©æ¶ˆæ¯</font> |
| <font style="color:rgb(28, 30, 33);">LLM</font> | <font style="color:rgb(28, 30, 33);">å•ä¸ªå­—ç¬¦ä¸²ã€èŠå¤©æ¶ˆæ¯åˆ—è¡¨æˆ–æç¤ºå€¼</font> | <font style="color:rgb(28, 30, 33);">å­—ç¬¦ä¸²</font> |
| <font style="color:rgb(28, 30, 33);">è¾“å‡ºè§£æå™¨</font> | <font style="color:rgb(28, 30, 33);">LLM æˆ–èŠå¤©æ¨¡å‹çš„è¾“å‡º</font> | <font style="color:rgb(28, 30, 33);">å–å†³äºè§£æå™¨</font> |
| <font style="color:rgb(28, 30, 33);">æ£€ç´¢å™¨</font> | <font style="color:rgb(28, 30, 33);">å•ä¸ªå­—ç¬¦ä¸²</font> | <font style="color:rgb(28, 30, 33);">æ–‡æ¡£åˆ—è¡¨</font> |
| <font style="color:rgb(28, 30, 33);">å·¥å…·</font> | <font style="color:rgb(28, 30, 33);">å•ä¸ªå­—ç¬¦ä¸²æˆ–å­—å…¸ï¼Œå–å†³äºå·¥å…·</font> | <font style="color:rgb(28, 30, 33);">å–å†³äºå·¥å…·</font> |


<font style="color:rgb(28, 30, 33);">æ‰€æœ‰å¯è¿è¡Œå¯¹è±¡éƒ½å…¬å¼€è¾“å…¥å’Œè¾“å‡º </font>**<font style="color:rgb(28, 30, 33);">æ¨¡å¼</font>**<font style="color:rgb(28, 30, 33);"> ä»¥æ£€æŸ¥è¾“å…¥å’Œè¾“å‡ºï¼š</font>

+ `<font style="color:rgb(28, 30, 33);">input_schema</font>`<font style="color:rgb(28, 30, 33);">: ä»å¯è¿è¡Œå¯¹è±¡ç»“æ„è‡ªåŠ¨ç”Ÿæˆçš„è¾“å…¥ Pydantic æ¨¡å‹</font>
+ `<font style="color:rgb(28, 30, 33);">output_schema</font>`<font style="color:rgb(28, 30, 33);">: ä»å¯è¿è¡Œå¯¹è±¡ç»“æ„è‡ªåŠ¨ç”Ÿæˆçš„è¾“å‡º Pydantic æ¨¡å‹</font>



<font style="color:rgb(28, 30, 33);">æµå¼è¿è¡Œå¯¹äºä½¿åŸºäº LLM çš„åº”ç”¨ç¨‹åºå¯¹æœ€ç»ˆç”¨æˆ·å…·æœ‰å“åº”æ€§è‡³å…³é‡è¦ã€‚ é‡è¦çš„ LangChain åŸè¯­ï¼Œå¦‚</font>[<font style="color:rgb(28, 30, 33);">èŠå¤©æ¨¡å‹</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#chat-models)<font style="color:rgb(28, 30, 33);">ã€</font>[<font style="color:rgb(28, 30, 33);">è¾“å‡ºè§£æå™¨</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#output-parsers)<font style="color:rgb(28, 30, 33);">ã€</font>[<font style="color:rgb(28, 30, 33);">æç¤ºæ¨¡æ¿</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#prompt-templates)<font style="color:rgb(28, 30, 33);">ã€</font>[<font style="color:rgb(28, 30, 33);">æ£€ç´¢å™¨</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#retrievers)<font style="color:rgb(28, 30, 33);">å’Œ</font>[<font style="color:rgb(28, 30, 33);">ä»£ç†</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#agents)<font style="color:rgb(28, 30, 33);">éƒ½å®ç°äº† LangChain</font><font style="color:rgb(28, 30, 33);"> </font>[<font style="color:rgb(28, 30, 33);">Runnable æ¥å£</font>](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#interface)<font style="color:rgb(28, 30, 33);">ã€‚ è¯¥æ¥å£æä¾›äº†ä¸¤ç§é€šç”¨çš„æµå¼å†…å®¹æ–¹æ³•ï¼š</font>

1. <font style="color:rgb(28, 30, 33);">åŒæ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">stream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œå¼‚æ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);">ï¼šæµå¼ä¼ è¾“é“¾ä¸­çš„</font>**<font style="color:rgb(28, 30, 33);">æœ€ç»ˆè¾“å‡º</font>**<font style="color:rgb(28, 30, 33);">çš„</font>**<font style="color:rgb(28, 30, 33);">é»˜è®¤å®ç°</font>**<font style="color:rgb(28, 30, 33);">ã€‚</font>
2. <font style="color:rgb(28, 30, 33);">å¼‚æ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream_events</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å’Œå¼‚æ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream_log</font>`<font style="color:rgb(28, 30, 33);">ï¼šè¿™äº›æ–¹æ³•æä¾›äº†ä¸€ç§ä»é“¾ä¸­æµå¼ä¼ è¾“</font>**<font style="color:rgb(28, 30, 33);">ä¸­é—´æ­¥éª¤</font>**<font style="color:rgb(28, 30, 33);">å’Œ</font>**<font style="color:rgb(28, 30, 33);">æœ€ç»ˆè¾“å‡º</font>**<font style="color:rgb(28, 30, 33);">çš„æ–¹å¼ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ç§æ–¹æ³•ï¼Œå¹¶å°è¯•ç†è§£å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚</font>

### <font style="color:rgb(28, 30, 33);">Stream(æµ)</font>
<font style="color:rgb(28, 30, 33);">æ‰€æœ‰</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">Runnable</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">å¯¹è±¡éƒ½å®ç°äº†ä¸€ä¸ªåä¸º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">stream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„åŒæ­¥æ–¹æ³•å’Œä¸€ä¸ªåä¸º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„å¼‚æ­¥å˜ä½“ã€‚ è¿™äº›æ–¹æ³•æ—¨åœ¨ä»¥å—çš„å½¢å¼æµå¼ä¼ è¾“æœ€ç»ˆè¾“å‡ºï¼Œå°½å¿«è¿”å›æ¯ä¸ªå—ã€‚ åªæœ‰åœ¨ç¨‹åºä¸­çš„æ‰€æœ‰æ­¥éª¤éƒ½çŸ¥é“å¦‚ä½•å¤„ç†</font>**<font style="color:rgb(28, 30, 33);">è¾“å…¥æµ</font>**<font style="color:rgb(28, 30, 33);">æ—¶ï¼Œæ‰èƒ½è¿›è¡Œæµå¼ä¼ è¾“ï¼›å³ï¼Œé€ä¸ªå¤„ç†è¾“å…¥å—ï¼Œå¹¶äº§ç”Ÿç›¸åº”çš„è¾“å‡ºå—ã€‚ è¿™ç§å¤„ç†çš„å¤æ‚æ€§å¯ä»¥æœ‰æ‰€ä¸åŒï¼Œä»ç®€å•çš„ä»»åŠ¡ï¼Œå¦‚å‘å‡º LLM ç”Ÿæˆçš„ä»¤ç‰Œï¼Œåˆ°æ›´å…·æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ï¼Œå¦‚åœ¨æ•´ä¸ª JSON å®Œæˆä¹‹å‰æµå¼ä¼ è¾“ JSON ç»“æœçš„éƒ¨åˆ†ã€‚ å¼€å§‹æ¢ç´¢æµå¼ä¼ è¾“çš„æœ€ä½³æ–¹æ³•æ˜¯ä» LLM åº”ç”¨ç¨‹åºä¸­æœ€é‡è¦çš„ç»„ä»¶å¼€å§‹â€”â€”LLM æœ¬èº«ï¼</font>

#### <font style="color:rgb(28, 30, 33);">LLM å’ŒèŠå¤©æ¨¡å‹</font>
<font style="color:rgb(28, 30, 33);">å¤§å‹è¯­è¨€æ¨¡å‹åŠå…¶èŠå¤©å˜ä½“æ˜¯åŸºäº LLM çš„åº”ç”¨ç¨‹åºçš„ä¸»è¦ç“¶é¢ˆã€‚ å¤§å‹è¯­è¨€æ¨¡å‹å¯èƒ½éœ€è¦</font>**<font style="color:rgb(28, 30, 33);">å‡ ç§’é’Ÿ</font>**<font style="color:rgb(28, 30, 33);">æ‰èƒ½å¯¹æŸ¥è¯¢ç”Ÿæˆå®Œæ•´çš„å“åº”ã€‚è¿™æ¯”åº”ç”¨ç¨‹åºå¯¹æœ€ç»ˆç”¨æˆ·å…·æœ‰å“åº”æ€§çš„</font>**<font style="color:rgb(28, 30, 33);">çº¦ 200-300 æ¯«ç§’</font>**<font style="color:rgb(28, 30, 33);">çš„é˜ˆå€¼è¦æ…¢å¾—å¤šã€‚ ä½¿åº”ç”¨ç¨‹åºå…·æœ‰æ›´é«˜çš„å“åº”æ€§çš„å…³é”®ç­–ç•¥æ˜¯æ˜¾ç¤ºä¸­é—´è¿›åº¦ï¼›å³ï¼Œé€ä¸ªä»¤ç‰Œæµå¼ä¼ è¾“æ¨¡å‹çš„è¾“å‡ºã€‚ æˆ‘ä»¬å°†å±•ç¤ºä½¿ç”¨èŠå¤©æ¨¡å‹è¿›è¡Œæµå¼ä¼ è¾“çš„ç¤ºä¾‹ã€‚ä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ä¸€ä¸ªï¼š</font>

<font style="color:rgb(28, 30, 33);">è®©æˆ‘ä»¬ä»åŒæ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">stream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">API å¼€å§‹ï¼š</font>

```python
#stream_llm.py
chunks = []
for chunk in model.stream("å¤©ç©ºæ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ"):
    chunks.append(chunk)
    print(chunk.content, end="|", flush=True)
```

```plain
å¤©|ç©º|æ˜¯|ä»€|ä¹ˆ|é¢œ|è‰²|ï¼Ÿ|
```

<font style="color:rgb(28, 30, 33);">æˆ–è€…ï¼Œå¦‚æœæ‚¨åœ¨å¼‚æ­¥ç¯å¢ƒä¸­å·¥ä½œï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¼‚æ­¥</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">APIï¼š</font>

```python
#astream_llm.py
chunks = []
async for chunk in model.astream("å¤©ç©ºæ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ"):
    chunks.append(chunk)
    print(chunk.content, end="|", flush=True)
```

```plain
å¤©|ç©º|æ˜¯|ä»€|ä¹ˆ|é¢œ|è‰²|ï¼Ÿ|
```

<font style="color:rgb(28, 30, 33);">è®©æˆ‘ä»¬æ£€æŸ¥å…¶ä¸­ä¸€ä¸ªå—ï¼š</font>

```python
chunks[1]
```

```plain
AIMessageChunk(content='å¤©', id='run-b36bea64-5511-4d7a-b6a3-a07b3db0c8e7')
```

<font style="color:rgb(28, 30, 33);">æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªç§°ä¸º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">AIMessageChunk</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„ä¸œè¥¿ã€‚è¯¥å—è¡¨ç¤º</font><font style="color:rgb(28, 30, 33);"> </font>`<font style="color:rgb(28, 30, 33);">AIMessage</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">çš„ä¸€éƒ¨åˆ†ã€‚ æ¶ˆæ¯å—æ˜¯å¯å åŠ çš„â€”â€”å¯ä»¥ç®€å•åœ°å°†å®ƒä»¬ç›¸åŠ ä»¥è·å¾—åˆ°ç›®å‰ä¸ºæ­¢çš„å“åº”çŠ¶æ€ï¼</font>

```python
chunks[0] + chunks[1] + chunks[2] + chunks[3] + chunks[4]
```

```plain
AIMessageChunk(content='å¤©ç©ºæ˜¯ä»€ä¹ˆé¢œè‰²', id='run-b36bea64-5511-4d7a-b6a3-a07b3db0c8e7')
```

#### <font style="color:rgb(28, 30, 33);">Chain(é“¾)</font>
<font style="color:rgb(28, 30, 33);">å‡ ä¹æ‰€æœ‰çš„ LLM åº”ç”¨ç¨‹åºéƒ½æ¶‰åŠä¸æ­¢ä¸€æ­¥çš„æ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯è°ƒç”¨è¯­è¨€æ¨¡å‹ã€‚ è®©æˆ‘ä»¬ä½¿ç”¨ </font>`<font style="color:rgb(28, 30, 33);">LangChain è¡¨è¾¾å¼è¯­è¨€</font>`<font style="color:rgb(28, 30, 33);"> (</font>`<font style="color:rgb(28, 30, 33);">LCEL</font>`<font style="color:rgb(28, 30, 33);">) æ„å»ºä¸€ä¸ªç®€å•çš„é“¾ï¼Œè¯¥é“¾ç»“åˆäº†ä¸€ä¸ªæç¤ºã€æ¨¡å‹å’Œè§£æå™¨ï¼Œå¹¶éªŒè¯æµå¼ä¼ è¾“æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ </font>[<font style="color:rgb(28, 30, 33);">StrOutputParser</font>](https://api.python.langchain.com/en/latest/output_parsers/langchain_core.output_parsers.string.StrOutputParser.html)<font style="color:rgb(28, 30, 33);"> æ¥è§£ææ¨¡å‹çš„è¾“å‡ºã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è§£æå™¨ï¼Œä» </font>`<font style="color:rgb(28, 30, 33);">AIMessageChunk</font>`<font style="color:rgb(28, 30, 33);"> ä¸­æå– </font>`<font style="color:rgb(28, 30, 33);">content</font>`<font style="color:rgb(28, 30, 33);"> å­—æ®µï¼Œç»™å‡ºæ¨¡å‹è¿”å›çš„ </font>`<font style="color:rgb(28, 30, 33);">token</font>`<font style="color:rgb(28, 30, 33);">ã€‚</font>

LCEL æ˜¯ä¸€ç§_å£°æ˜å¼_çš„æ–¹å¼ï¼Œé€šè¿‡å°†ä¸åŒçš„ LangChain åŸè¯­é“¾æ¥åœ¨ä¸€èµ·æ¥æŒ‡å®šä¸€ä¸ªâ€œç¨‹åºâ€ã€‚ä½¿ç”¨ LCEL åˆ›å»ºçš„é“¾å¯ä»¥è‡ªåŠ¨å®ç° `stream` å’Œ `astream`ï¼Œä»è€Œå®ç°å¯¹æœ€ç»ˆè¾“å‡ºçš„æµå¼ä¼ è¾“ã€‚äº‹å®ä¸Šï¼Œä½¿ç”¨ LCEL åˆ›å»ºçš„é“¾å®ç°äº†æ•´ä¸ªæ ‡å‡† Runnable æ¥å£ã€‚

```python
#astream_chain.py
from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import ChatPromptTemplate
prompt = ChatPromptTemplate.from_template("ç»™æˆ‘è®²ä¸€ä¸ªå…³äº{topic}çš„ç¬‘è¯")
parser = StrOutputParser()
chain = prompt | model | parser
async for chunk in chain.astream({"topic": "é¹¦é¹‰"}):
    print(chunk, end="|", flush=True)
    
```



```plain
|ä¸€ä¸ª|äºº|å»|å® |ç‰©|åº—|ä¹°|é¹¦|é¹‰|ã€‚|åº—|å‘˜|è¯´|ï¼šâ€œ|è¿™|åª|é¹¦|é¹‰|ä¼š|è¯´|è¯|ã€‚â€|
|ä¹°|å›|å®¶|å|ï¼Œ|é‚£|äºº|å‘|ç°|é¹¦|é¹‰|åª|ä¼š|è¯´|ä¸€|å¥|è¯|ï¼šâ€œ|æˆ‘|æ˜¯|é¹¦|é¹‰|ã€‚â€|
|é‚£|äºº|å°±|å»|æ‰¾|åº—|å‘˜|ï¼Œ|è¯´|ï¼šâ€œ|ä½ |ä¸|æ˜¯|è¯´|è¿™|åª|é¹¦|é¹‰|ä¼š|è¯´|è¯|å—|ï¼Ÿ|å®ƒ|åª|ä¼š|è¯´|â€˜|æˆ‘|æ˜¯|é¹¦|é¹‰|â€™|ã€‚â€|
|åº—|å‘˜|å›|ç­”|ï¼šâ€œ|å®ƒ|ç¡®|å®|ä¼š|è¯´|è¯|ï¼Œ|ä½ |æƒ³|å®ƒ|æ€|ä¹ˆ|å¯èƒ½|çŸ¥|é“|è‡ª|å·±|æ˜¯|é¹¦|é¹‰|å‘¢|ï¼Ÿâ€||
```



è¯·æ³¨æ„ï¼Œå³ä½¿æˆ‘ä»¬åœ¨ä¸Šé¢çš„é“¾æ¡æœ«å°¾ä½¿ç”¨äº†`parser`ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è·å¾—æµå¼è¾“å‡ºã€‚`parser`ä¼šå¯¹æ¯ä¸ªæµå¼å—è¿›è¡Œæ“ä½œã€‚è®¸å¤šLCELåŸºå…ƒä¹Ÿæ”¯æŒè¿™ç§è½¬æ¢å¼çš„æµå¼ä¼ é€’ï¼Œè¿™åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶éå¸¸æ–¹ä¾¿ã€‚

è‡ªå®šä¹‰å‡½æ•°å¯ä»¥è¢«è®¾è®¡ä¸ºè¿”å›ç”Ÿæˆå™¨ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæ“ä½œæµã€‚

æŸäº›å¯è¿è¡Œå®ä½“ï¼Œå¦‚æç¤ºæ¨¡æ¿å’ŒèŠå¤©æ¨¡å‹ï¼Œæ— æ³•å¤„ç†å•ä¸ªå—ï¼Œè€Œæ˜¯èšåˆæ‰€æœ‰å…ˆå‰çš„æ­¥éª¤ã€‚è¿™äº›å¯è¿è¡Œå®ä½“å¯ä»¥ä¸­æ–­æµå¤„ç†ã€‚

LangChainè¡¨è¾¾è¯­è¨€å…è®¸æ‚¨å°†é“¾çš„æ„å»ºä¸ä½¿ç”¨æ¨¡å¼ï¼ˆä¾‹å¦‚åŒæ­¥/å¼‚æ­¥ã€æ‰¹å¤„ç†/æµå¼ç­‰ï¼‰åˆ†å¼€ã€‚å¦‚æœè¿™ä¸æ‚¨æ„å»ºçš„å†…å®¹æ— å…³ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¾èµ–äºæ ‡å‡†çš„å‘½ä»¤å¼ç¼–ç¨‹æ–¹æ³•ï¼Œé€šè¿‡åœ¨æ¯ä¸ªç»„ä»¶ä¸Šè°ƒç”¨invokeã€batchæˆ–streamï¼Œå°†ç»“æœåˆ†é…ç»™å˜é‡ï¼Œç„¶åæ ¹æ®éœ€è¦åœ¨ä¸‹æ¸¸ä½¿ç”¨å®ƒä»¬ã€‚

**ä½¿ç”¨è¾“å…¥æµ**

å¦‚æœæ‚¨æƒ³è¦åœ¨è¾“å‡ºç”Ÿæˆæ—¶ä»ä¸­æµå¼ä¼ è¾“JSONï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

å¦‚æœæ‚¨ä¾èµ–`json.loads`æ¥è§£æéƒ¨åˆ†JSONï¼Œé‚£ä¹ˆè§£æå°†å¤±è´¥ï¼Œå› ä¸ºéƒ¨åˆ†JSONä¸ä¼šæ˜¯æœ‰æ•ˆçš„JSONã€‚

æ‚¨å¯èƒ½ä¼šæŸæ‰‹æ— ç­–ï¼Œå£°ç§°æ— æ³•æµå¼ä¼ è¾“JSONã€‚

äº‹å®è¯æ˜ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹â€”â€”è§£æå™¨éœ€è¦åœ¨**è¾“å…¥æµ**ä¸Šæ“ä½œï¼Œå¹¶å°è¯•å°†éƒ¨åˆ†JSONâ€œè‡ªåŠ¨å®Œæˆâ€ä¸ºæœ‰æ•ˆçŠ¶æ€ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ ·ä¸€ä¸ªè§£æå™¨çš„è¿è¡Œï¼Œä»¥äº†è§£è¿™æ„å‘³ç€ä»€ä¹ˆã€‚

```python
model = ChatOpenAI(model="gpt-4")
parser = StrOutputParser()
chain = (
        model | JsonOutputParser()
    # ç”±äºLangchainæ—§ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªé”™è¯¯ï¼ŒJsonOutputParseræœªèƒ½ä»æŸäº›æ¨¡å‹ä¸­æµå¼ä¼ è¾“ç»“æœ
)
async def async_stream():
    async for text in chain.astream(
            "ä»¥JSON æ ¼å¼è¾“å‡ºæ³•å›½ã€è¥¿ç­ç‰™å’Œæ—¥æœ¬çš„å›½å®¶åŠå…¶äººå£åˆ—è¡¨ã€‚"
            'ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰â€œcountriesâ€å¤–éƒ¨é”®çš„å­—å…¸ï¼Œå…¶ä¸­åŒ…å«å›½å®¶åˆ—è¡¨ã€‚'
            "æ¯ä¸ªå›½å®¶éƒ½åº”è¯¥æœ‰é”®`name`å’Œ`population`"
    ):
        print(text, flush=True)
```



```json
{}
{'countries': []}
{'countries': [{}]}
{'countries': [{'name': ''}]}
{'countries': [{'name': 'France'}]}
{'countries': [{'name': 'France', 'population': 670}]}
{'countries': [{'name': 'France', 'population': 670810}]}
{'countries': [{'name': 'France', 'population': 67081000}]}
{'countries': [{'name': 'France', 'population': 67081000}, {}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': ''}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain'}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 467}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 467330}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': ''}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': 'Japan'}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': 'Japan', 'population': 126}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': 'Japan', 'population': 126300}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 46733038}, {'name': 'Japan', 'population': 126300000}]}
```





### <font style="color:rgb(28, 30, 33);">Stream events(äº‹ä»¶æµ)</font>
<font style="color:rgb(28, 30, 33);">ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†</font>`<font style="color:rgb(28, 30, 33);">stream</font>`<font style="color:rgb(28, 30, 33);">å’Œ</font>`<font style="color:rgb(28, 30, 33);">astream</font>`<font style="color:rgb(28, 30, 33);">çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬è¿›å…¥äº‹ä»¶æµçš„ä¸–ç•Œã€‚</font><font style="color:rgb(28, 30, 33);">ğŸï¸</font>

<font style="color:rgb(28, 30, 33);">äº‹ä»¶æµæ˜¯ä¸€ä¸ª</font>**<font style="color:rgb(28, 30, 33);">beta</font>**<font style="color:rgb(28, 30, 33);"> APIã€‚è¿™ä¸ªAPIå¯èƒ½ä¼šæ ¹æ®åé¦ˆç•¥å¾®æ›´æ”¹ã€‚</font>

æœ¬æŒ‡å—æ¼”ç¤ºäº†`V2` APIï¼Œå¹¶ä¸”éœ€è¦ langchain-core >= 0.2ã€‚å¯¹äºä¸æ—§ç‰ˆæœ¬ LangChain å…¼å®¹çš„`V1` APIï¼Œè¯·å‚é˜…[è¿™é‡Œ](https://python.langchain.com/v0.1/docs/expression_language/streaming/#using-stream-events)ã€‚

```python
import langchain_core
langchain_core.__version__
```

<font style="color:rgb(28, 30, 33);">ä¸ºäº†ä½¿</font>`<font style="color:rgb(28, 30, 33);">astream_events</font>`<font style="color:rgb(28, 30, 33);"> </font><font style="color:rgb(28, 30, 33);">APIæ­£å¸¸å·¥ä½œï¼š</font>

+ <font style="color:rgb(28, 30, 33);">åœ¨ä»£ç ä¸­å°½å¯èƒ½ä½¿ç”¨</font>`<font style="color:rgb(28, 30, 33);">async</font>`<font style="color:rgb(28, 30, 33);">ï¼ˆä¾‹å¦‚ï¼Œå¼‚æ­¥å·¥å…·ç­‰ï¼‰</font>
+ <font style="color:rgb(28, 30, 33);">å¦‚æœå®šä¹‰è‡ªå®šä¹‰å‡½æ•°/å¯è¿è¡Œé¡¹ï¼Œè¯·ä¼ æ’­å›è°ƒ</font>
+ <font style="color:rgb(28, 30, 33);">åœ¨æ²¡æœ‰ LCEL çš„æƒ…å†µä¸‹ä½¿ç”¨å¯è¿è¡Œé¡¹æ—¶ï¼Œè¯·ç¡®ä¿åœ¨LLMsä¸Šè°ƒç”¨</font>`<font style="color:rgb(28, 30, 33);">.astream()</font>`<font style="color:rgb(28, 30, 33);">è€Œä¸æ˜¯</font>`<font style="color:rgb(28, 30, 33);">.ainvoke</font>`<font style="color:rgb(28, 30, 33);">ä»¥å¼ºåˆ¶LLMæµå¼ä¼ è¾“ä»¤ç‰Œ</font>

#### <font style="color:rgb(28, 30, 33);">äº‹ä»¶å‚è€ƒ</font>
<font style="color:rgb(28, 30, 33);">ä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒè¡¨ï¼Œæ˜¾ç¤ºå„ç§å¯è¿è¡Œå¯¹è±¡å¯èƒ½å‘å‡ºçš„ä¸€äº›äº‹ä»¶ã€‚</font>

å½“æµå¼ä¼ è¾“æ­£ç¡®å®ç°æ—¶ï¼Œå¯¹äºå¯è¿è¡Œé¡¹çš„è¾“å…¥ç›´åˆ°è¾“å…¥æµå®Œå…¨æ¶ˆè€—åæ‰ä¼šçŸ¥é“ã€‚è¿™æ„å‘³ç€`inputs`é€šå¸¸ä»…åŒ…æ‹¬`end`äº‹ä»¶ï¼Œè€Œä¸åŒ…æ‹¬`start`äº‹ä»¶ã€‚

| äº‹ä»¶ | åç§° | å— | è¾“å…¥ | è¾“å‡º |
| --- | --- | --- | --- | --- |
| on_chat_model_start | [æ¨¡å‹åç§°] | | {"messages": [[SystemMessage, HumanMessage]]} | |
| on_chat_model_end | [æ¨¡å‹åç§°] | | {"messages": [[SystemMessage, HumanMessage]]} | AIMessageChunk(content="hello world") |
| on_llm_start | [æ¨¡å‹åç§°] | | {'input': 'hello'} | |
| on_llm_stream | [æ¨¡å‹åç§°] | 'Hello' | | |
| on_llm_end | [æ¨¡å‹åç§°] | | 'Hello human!' | |
| on_chain_start | format_docs | | | |
| on_chain_stream | format_docs | "hello world!, goodbye world!" | | |
| on_chain_end | format_docs | | [Document(...)] | "hello world!, goodbye world!" |
| on_tool_start | some_tool | | {"x": 1, "y": "2"} | |
| on_tool_end | some_tool | | | {"x": 1, "y": "2"} |
| on_retriever_start | [æ£€ç´¢å™¨åç§°] | | {"query": "hello"} | |
| on_retriever_end | [æ£€ç´¢å™¨åç§°] | | {"query": "hello"} | [Document(...), ..] |
| on_prompt_start | [æ¨¡æ¿åç§°] | | {"question": "hello"} | |
| on_prompt_end | [æ¨¡æ¿åç§°] | | {"question": "hello"} | ChatPromptValue(messages: [SystemMessage, ...]) |


#### <font style="color:rgb(28, 30, 33);">èŠå¤©æ¨¡å‹</font>
<font style="color:rgb(28, 30, 33);">è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹èŠå¤©æ¨¡å‹äº§ç”Ÿçš„äº‹ä»¶ã€‚</font>

```python
#astream_event.py
events = []
async for event in model.astream_events("hello", version="v2"):
    events.append(event)
```

```plain
/home/eugene/src/langchain/libs/core/langchain_core/_api/beta_decorator.py:87: LangChainBetaWarning: This API is in beta and may change in the future.
  warn_beta(
```

å˜¿ï¼ŒAPIä¸­é‚£ä¸ªæœ‰è¶£çš„`version="v2"`å‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸğŸ˜¾ è¿™æ˜¯ä¸€ä¸ª**beta API**ï¼Œæˆ‘ä»¬å‡ ä¹è‚¯å®šä¼šå¯¹å…¶è¿›è¡Œä¸€äº›æ›´æ”¹ï¼ˆäº‹å®ä¸Šï¼Œæˆ‘ä»¬å·²ç»åšäº†ï¼ï¼‰ è¿™ä¸ªç‰ˆæœ¬å‚æ•°å°†å…è®¸æˆ‘ä»¬æœ€å°åŒ–å¯¹æ‚¨ä»£ç çš„ç ´åæ€§æ›´æ”¹ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬ç°åœ¨è®©æ‚¨æ„Ÿåˆ°çƒ¦æ¼ï¼Œè¿™æ ·ä»¥åå°±ä¸å¿…å†çƒ¦æ¼äº†ã€‚ `v2`ä»…é€‚ç”¨äº langchain-core>=0.2.0ã€‚

<font style="color:rgb(28, 30, 33);">è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€äº›å¼€å§‹äº‹ä»¶å’Œä¸€äº›ç»“æŸäº‹ä»¶ã€‚</font>

```python
events[:3]
```

```json
[{'event': 'on_chat_model_start',
  'data': {'input': 'hello'},
  'name': 'ChatAnthropic',
  'tags': [],
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'metadata': {}},
 {'event': 'on_chat_model_stream',
  'data': {'chunk': AIMessageChunk(content='Hello', id='run-a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3')},
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'name': 'ChatAnthropic',
  'tags': [],
  'metadata': {}},
 {'event': 'on_chat_model_stream',
  'data': {'chunk': AIMessageChunk(content='!', id='run-a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3')},
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'name': 'ChatAnthropic',
  'tags': [],
  'metadata': {}}]
```

```python
events[-2:]
```

```json
[{'event': 'on_chat_model_stream',
  'data': {'chunk': AIMessageChunk(content='?', id='run-a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3')},
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'name': 'ChatAnthropic',
  'tags': [],
  'metadata': {}},
  {'event': 'on_chat_model_end',
  'data': {'output': AIMessageChunk(content='Hello! How can I assist you today?', id='run-a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3')},
  'run_id': 'a81e4c0f-fc36-4d33-93bc-1ac25b9bb2c3',
  'name': 'ChatAnthropic',
  'tags': [],
  'metadata': {}}]
```



